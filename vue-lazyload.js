/*!
 * Vue-Lazyload.js v1.1.4
 * (c) 2018 Awe <hilongjw@gmail.com>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueLazyload=t()}(this,function(){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_="undefined"!=typeof window,r=_&&"IntersectionObserver"in window,k={event:"event",observer:"observer"};function o(e,t){if(e.length){var n=e.indexOf(t);return-1<n?e.splice(n,1):void 0}}function a(e,t){if(!e||!t)return e||{};if(e instanceof Object)for(var n in t)e[n]=t[n];return e}function v(e,t){if("IMG"===e.tagName&&e.getAttribute("data-srcset")){var n=e.getAttribute("data-srcset"),r=[],i=e.parentNode.offsetWidth*t,o=void 0,a=void 0,s=void 0;(n=n.trim().split(",")).map(function(e){e=e.trim(),-1===(o=e.lastIndexOf(" "))?(a=e,s=999998):(a=e.substr(0,o),s=parseInt(e.substr(o+1,e.length-o-2),10)),r.push([s,a])}),r.sort(function(e,t){if(e[0]<t[0])return-1;if(e[0]>t[0])return 1;if(e[0]===t[0]){if(-1!==t[1].indexOf(".webp",t[1].length-5))return 1;if(-1!==e[1].indexOf(".webp",e[1].length-5))return-1}return 0});for(var u="",l=void 0,d=r.length,c=0;c<d;c++)if((l=r[c])[0]>=i){u=l[1];break}return u}}function u(e,t){for(var n=void 0,r=0,i=e.length;r<i;r++)if(t(e[r])){n=e[r];break}return n}var E=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return _&&window.devicePixelRatio||e};var i=function(){if(_){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}}(),l={on:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];i?e.addEventListener(t,n,{capture:r,passive:!0}):e.addEventListener(t,n,r)},off:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.removeEventListener(t,n,r)}},h=function(e,t,n){var r=new Image;r.src=e.src,r.onload=function(){t({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src})},r.onerror=function(e){n(e)}},d=function(e,t){return"undefined"!=typeof getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]},p=function(e){if(_){if(!(e instanceof HTMLElement))return window;for(var t,n=e;n&&n!==document.body&&n!==document.documentElement&&n.parentNode;){if(/(scroll|auto)/.test(d(t=n,"overflow")+d(t,"overflow-y")+d(t,"overflow-x")))return n;n=n.parentNode}return window}};var f=function(){function i(e){var t=e.el,n=e.$parent,r=e.options;L(this,i),this.el=t,this.rect=t.getBoundingClientRect(),this.performanceData={init:Date.now(),loadStart:null,loadEnd:null},this.$parent=n,this.options=r,this.initState()}return t(i,[{key:"initState",value:function(){this.state={error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"update",value:function(){throw new Error("update抽象方法，不能实例化")}},{key:"checkInView",value:function(){throw new Error("checkInView抽象方法，不能实例化")}},{key:"load",value:function(){throw new Error("load抽象方法，不能实例化")}},{key:"destroy",value:function(){throw new Error("destroy抽象方法，不能实例化")}}]),i}(),y=function(e){function a(e){var t=e.el,n=e.options,r=e.trigger,i=e.handler;L(this,a);var o=c(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,{el:t,options:n}));return o.trigger=r,o.handler=i,o}return n(a,f),t(a,[{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&0<this.rect.right}},{key:"load",value:function(t,n){var r=this;Promise.resolve(this.handler()).then(function(e){e||r.afterLoad(t,n)})}},{key:"afterLoad",value:function(e,t){e.ListenerQueue.splice(t,1)}},{key:"destroy",value:function(){console.log("删除"),this.el=null}}]),a}(),g={},b=function(e){function d(e){var t=e.el,n=e.src,r=e.error,i=e.loading,o=e.bindType,a=e.$parent,s=e.options,u=e.elRenderer;L(this,d);var l=c(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,{el:t}));return l.src=n,l.error=r,l.loading=i,l.bindType=o,l.attempt=0,l.naturalHeight=0,l.naturalWidth=0,l.options=s,l.filter(),l.initState(),l.performanceData={init:Date.now(),loadStart:null,loadEnd:null},l.rect=t.getBoundingClientRect(),l.$parent=a,l.elRenderer=u,console.log(l.src),l.render("loading",!1),l}return n(d,f),t(d,[{key:"initState",value:function(){this.state={error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"update",value:function(e){var t=e.src,n=e.loading,r=e.error,i=this.src;this.src=t,this.loading=n,this.error=r,this.filter(),i!==this.src&&(this.attempt=0,this.initState())}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&0<this.rect.right}},{key:"filter",value:function(){var t=this;(function(e){if(!(e instanceof Object))return[];if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t})(this.options.filter).map(function(e){t.options.filter[e](t,t.options)})}},{key:"renderLoading",value:function(t){var n=this;h({src:this.loading},function(e){n.render("loading",!1),t()},function(e){t(),n.options.silent||console.warn("VueLazyload log: load failed with loading image("+n.loading+")")})}},{key:"load",value:function(t,n){var r=this;return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void this.afterLoad(t,n)):this.state.loaded||g[this.src]?(this.state.loaded=!0,this.afterLoad(t,n),this.render("loaded",!0)):void this.renderLoading(function(){r.attempt++,r.record("loadStart"),h({src:r.src},function(e){r.naturalHeight=e.naturalHeight,r.naturalWidth=e.naturalWidth,r.state.loaded=!0,r.state.error=!1,r.record("loadEnd"),r.render("loaded",!1),g[r.src]=1,r.afterLoad(t,n)},function(e){r.state.error=!0,r.state.loaded=!1,r.render("error",!1)})})}},{key:"afterLoad",value:function(e,t){e.ListenerQueue.splice(t,1)}},{key:"render",value:function(e,t){this.elRenderer(this,e,t)}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"destroy",value:function(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}]),d}(),m=function(e){function a(e){var t=e.el,n=e.options,r=e.trigger,i=e.handler;L(this,a);var o=c(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,{el:t,options:n}));return o.trigger=r,o.handler=i,o}return n(a,f),t(a,[{key:"checkInView",value:function(){if("function"!=typeof this.trigger)throw new Error("自定义触发函数必须是个方法!!");return this.trigger()}},{key:"load",value:function(t,n){var r=this;Promise.resolve(this.handler()).then(function(e){e||r.afterLoad(t,n)})}},{key:"afterLoad",value:function(e,t){e.ListenerQueue.splice(t,1)}},{key:"destroy",value:function(){console.log("删除"),this.el=null}}]),a}(),T=function e(t,n){switch(L(this,e),t){case"lazy":return new b(n);case"scroll":return new y(n);case"custom":return new m(n);default:console.warn("没有对应的类")}},A="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",O=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],$={rootMargin:"0px",threshold:0};function w(f){return function(){function w(e){var i,o,a,s,t=e.preLoad,n=e.error,r=e.throttleWait,u=e.preLoadTop,l=e.dispatchEvent,d=e.loading,c=e.attempt,h=e.silent,f=void 0===h||h,v=e.scale,p=e.listenEvents,y=(e.hasbind,e.filter),g=e.adapter,b=e.observer,m=e.observerOptions;L(this,w),this.version="1.1.4",this.mode=k.event,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:f,dispatchEvent:!!l,throttleWait:r||500,preLoad:t||1.3,preLoadTop:u||0,error:n||A,loading:d||A,attempt:c||3,scale:v||E(v),ListenEvents:p||O,hasbind:!1,supportWebp:function(){if(!_)return!1;var t=!0,e=document;try{var n=e.createElement("object");n.type="image/webp",n.style.visibility="hidden",n.innerHTML="!",e.body.appendChild(n),t=!n.offsetWidth,e.body.removeChild(n)}catch(e){t=!1}return t}(),filter:y||{},adapter:g||{},observer:!!b,observerOptions:m||$},this._initEvent(),this.lazyLoadHandler=(i=this._lazyLoadHandler.bind(this),o=this.options.throttleWait,a=null,s=0,function(){if(!a){var e=Date.now()-s,t=this,n=arguments,r=function(){s=Date.now(),a=!1,i.apply(t,n)};o<=e?r():a=setTimeout(r,o)}}),this.setMode(this.options.observer?k.observer:k.event)}return t(w,[{key:"config",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this.options,e)}},{key:"performance",value:function(){var t=[];return this.ListenerQueue.map(function(e){t.push(e.performance())}),t}},{key:"addLazyBox",value:function(e){this.ListenerQueue.push(e),_&&(this._addListenerTarget(window),this._observer&&this._observer.observe(e.el),e.$el&&e.$el.parentNode&&this._addListenerTarget(e.$el.parentNode))}},{key:"add",value:function(i,o,a){var s=this;if(function(e,t){for(var n=!1,r=0,i=e.length;r<i;r++)if(t(e[r])){n=!0;break}return n}(this.ListenerQueue,function(e){return e.el===i}))return this.update(i,o),f.nextTick(this.lazyLoadHandler);var e=this._valueFormatter(o.value),u=e.src,l=e.loading,d=e.error,c=e.trigger,h=e.handler;f.nextTick(function(){u=v(i,s.options.scale)||u,s._observer&&s._observer.observe(i);var e=Object.keys(o.modifiers)[0],t=void 0;e&&(t=(t=a.context.$refs[e])?t.$el||t:document.getElementById(e)),t||(t=p(i));var n,r=o.arg||"lazy";n=new T(r,{bindType:r,$parent:t,el:i,loading:l,error:d,src:u,elRenderer:s._elRenderer.bind(s),options:s.options,trigger:c,handler:h}),s.ListenerQueue.push(n),_&&(s._addListenerTarget(window),s._addListenerTarget(t)),s.lazyLoadHandler(),f.nextTick(function(){return s.lazyLoadHandler()})})}},{key:"update",value:function(t,e){var n=this,r=this._valueFormatter(e.value),i=r.src,o=r.loading,a=r.error;i=v(t,this.options.scale)||i;var s=u(this.ListenerQueue,function(e){return e.el===t});s&&s.update({src:i,loading:o,error:a}),this._observer&&this._observer.observe(t),this.lazyLoadHandler(),f.nextTick(function(){return n.lazyLoadHandler()})}},{key:"remove",value:function(t){if(t){this._observer&&this._observer.unobserve(t);var e=u(this.ListenerQueue,function(e){return e.el===t});e&&(this._removeListenerTarget(e.$parent),this._removeListenerTarget(window),o(this.ListenerQueue,e)&&e.destroy())}}},{key:"removeComponent",value:function(e){e&&(o(this.ListenerQueue,e),this._observer&&this._observer.unobserve(e.el),e.$parent&&e.$el.parentNode&&this._removeListenerTarget(e.$el.parentNode),this._removeListenerTarget(window))}},{key:"setMode",value:function(e){var t=this;r||e!==k.observer||(e=k.event),(this.mode=e)===k.event?(this._observer&&(this.ListenerQueue.forEach(function(e){t._observer.unobserve(e.el)}),this._observer=null),this.TargetQueue.forEach(function(e){t._initListen(e.el,!0)})):(this.TargetQueue.forEach(function(e){t._initListen(e.el,!1)}),this._initIntersectionObserver())}},{key:"_addListenerTarget",value:function(t){if(t){var e=u(this.TargetQueue,function(e){return e.el===t});return e?e.childrenCount++:(e={el:t,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===k.event&&this._initListen(e.el,!0),this.TargetQueue.push(e)),this.TargetIndex}}},{key:"_removeListenerTarget",value:function(n){var r=this;this.TargetQueue.forEach(function(e,t){e.el===n&&(e.childrenCount--,e.childrenCount||(r._initListen(e.el,!1),r.TargetQueue.splice(t,1),e=null))})}},{key:"_initListen",value:function(t,n){var r=this;this.options.ListenEvents.forEach(function(e){return l[n?"on":"off"](t,e,r.lazyLoadHandler)})}},{key:"_initEvent",value:function(){var i=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(e,t){i.Event.listeners[e].push(t)},this.$once=function(t,n){var r=i;i.$on(t,function e(){r.$off(t,e),n.apply(r,arguments)})},this.$off=function(e,t){t?o(i.Event.listeners[e],t):i.Event.listeners[e]=[]},this.$emit=function(e,t,n){i.Event.listeners[e].forEach(function(e){return e(t,n)})}}},{key:"_lazyLoadHandler",value:function(){var n=this;this.ListenerQueue.forEach(function(e,t){e.state.loaded||e.checkInView()&&e.load(n,t)})}},{key:"_initIntersectionObserver",value:function(){var t=this;r&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach(function(e){t._observer.observe(e.el)}))}},{key:"_observerHandler",value:function(e,t){var n=this;e.forEach(function(t){t.isIntersecting&&n.ListenerQueue.forEach(function(e){if(e.el===t.target){if(e.state.loaded)return n._observer.unobserve(e.el);e.load()}})})}},{key:"_elRenderer",value:function(e,t,n){if(e.el){var r=e.el,i=e.bindType,o=void 0;switch(t){case"loading":o=e.loading;break;case"error":o=e.error;break;default:o=e.src}if(i?r.style[i]="url("+o+")":r.getAttribute("src")!==o&&r.setAttribute("src",o),r.setAttribute("lazy",t),this.$emit(t,e,n),this.options.adapter[t]&&this.options.adapter[t](e,this.options),this.options.dispatchEvent){var a=new CustomEvent(t,{detail:e});r.dispatchEvent(a)}}}},{key:"_valueFormatter",value:function(e){var t,n=e,r=this.options.loading,i=this.options.error,o=null,a=null;return null!==(t=e)&&"object"===(void 0===t?"undefined":s(t))&&(e.src||this.options.silent||console.error("Vue Lazyload warning: miss src with "+e),n=e.src,r=e.loading||this.options.loading,i=e.error||this.options.error,o=e.handler,a=e.trigger),"function"==typeof e&&(o=e),{src:n,loading:r,error:i,handler:o,trigger:a}}}]),w}()}return{install:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=new(w(e))(n),i="2"===e.version.split(".")[0];e.prototype.$Lazyload=r,n.lazyComponent&&e.component("lazy-component",(t=r,{props:{tag:{type:String,default:"div"}},render:function(e){return e(this.tag,null,this.$slots.default)},data:function(){return{el:null,state:{loaded:!1},rect:{},show:!1}},mounted:function(){this.el=this.$el,t.addLazyBox(this),t.lazyLoadHandler()},beforeDestroy:function(){t.removeComponent(this)},methods:{getRect:function(){this.rect=this.$el.getBoundingClientRect()},checkInView:function(){return this.getRect(),_&&this.rect.top<window.innerHeight*t.options.preLoad&&0<this.rect.bottom&&this.rect.left<window.innerWidth*t.options.preLoad&&0<this.rect.right},load:function(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)}}})),i?e.directive("lazy",{bind:r.add.bind(r),update:r.update.bind(r),componentUpdated:r.lazyLoadHandler.bind(r),unbind:r.remove.bind(r)}):e.directive("lazy",{bind:r.lazyLoadHandler.bind(r),update:function(e,t){a(this.vm.$refs,this.vm.$els),r.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:e,oldValue:t},{context:this.vm})},unbind:function(){r.remove(this.el)}})}}});
